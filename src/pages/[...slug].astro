---
import WritingLayout from '@layouts/writing-layout.astro';
import ThoughtsLayout from '@layouts/thoughts-layout.astro';
import { ScrollProgress } from '@components/misc';
import { getCollection } from 'astro:content';
import { getReadingTime } from '@utils/index';

const { slug } = Astro.params;

const writings = await getCollection('writing');
const thoughts = await getCollection('thought');

const writing = writings.find((p) => p.slug === slug);
const thought = thoughts.find((p) => p.slug === slug);

if (!writing && !thought) return Astro.redirect('/404');

const post = writing ?? thought;
const { Content } = await post!.render();
const readingTime = getReadingTime(post!.body);
const heroImage = writing ? (writing.data.heroImage || `/og/writings/${slug}`) : undefined;
const ogImage = thought ? `/og/thoughts/${slug}` : undefined;
---

{writing ? (
	<WritingLayout {...writing.data} heroImage={heroImage!} readingTime={readingTime}>
		<Content />
		<ScrollProgress />
	</WritingLayout>
) : thought ? (
	<ThoughtsLayout {...thought.data} ogImage={ogImage!} readingTime={readingTime}>
		<Content />
		<ScrollProgress />
	</ThoughtsLayout>
) : null}
